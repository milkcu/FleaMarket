# FleaMarket


The initial version of flea market which deployed in [mysdnu.com](http://www.mysdnu.com/).

基于CodeIgniter的校园二手交易平台项目采用MVC轻量级框架CodeIgniter，包含用户、商品、订单、求购、私信等模块，提供管理员后台管理功能，前端采用Bootstrap布局，Android客户端为Crosswalk开发的混合应用。

## 架构设计

系统使用用MVC的架构模式，采用数据层、控制层、视图层三层结构。这三层紧密的联系在一起，但又互相独立，每一层内部的变化不影响其他层。每一层都对外提供接口，供上面一层调用，大大方便了系统的维护和开发。系统的重心在模型Model上，控制器通过调用模型和视图对外提供服务。由于系统覆盖多个平台和终端，系统采用API接口对外提供服务。

## 系统组成

系统将采用模块化设计，可大致分为4个子系统。

### （1）用户子系统

用户子系统需要实现基本的用户注册登录、密码找回等功能，用户具有买家和卖家双重身份。可以将用户分组，不同的用户组具有不同的权限。另外，闲置物品交易平台是建立在科大这个区域内的，还要通过科大邮箱实现用户认证功能，保证交易安全，对于未认证用户将看不到商品主人的联系信息。该部分的重点是系统安全，能够抵御各种扫描和攻击，保证用户信息不被泄露。

### （2）商品子系统

商品子系统需要实现的功能主要有商品的索引、展示、搜索、发布、删除、状态变更等操作，商品成交后将会从商品列表中移除。用户可以将发布的商品的页面分享出去，带来更多流量，该部分的重点是前端页面设计，能够实现各种分辨率、各种尺寸的设备的用户体验的统一。

### （3）私信子系统

用户在购买过程中可通过私信交流，系统将保留用户的私信记录，在一定程度上能够保证交易安全。初步设想的私信是使用数组加序列化存储的，该存储方式在数据量大时响应速度会减慢，新的存储方式还有待研究。

### （4）订单子系统

订单系统的存在能够保证交易对象的前后一致，并且用户可以清晰的看到商品是否售出。订单状态有五种：【创建】，【确认】，【完成】，【取消】，【删除】。 买家提交订单，订单状态为【创建】，此时买家可以选择【删除】订单或等待卖家【确认】订单。卖家收到买家订单请求，可以选择【取消】订单或【确认】接受订单。卖家【确认】订单后要及时送货上门或通知用户自提，当买家确认收货时订单【完成】。

## 技术要点

### （1）系统安全

系统的开发过程中要注意安全防护，保证数据的机密性、完整性、可用性。用户系统基于[CodeIgniter-Aauth](https://github.com/emreakay/CodeIgniter-Aauth)完成，具有DDoS保护等功能。

### （2）图片存储

作为闲置物品交易平台，图片是用户信息交流的媒介，图片的存取效率至关重要，当然图片数量和容量必然会很大，这里采用[七牛云存储平台](http://www.qiniu.com/)。应用将图片转换为Base64编码，将其传输到七牛服务器，并将结果回调给应用服务器。

### （3）信息审核

信息审核对于UGC来说至关重要，系统提供管理员管理功能，后期会增强无关信息的检测能力。同时我们会在用户注册登录、发布商品等关键步骤，记录用户的IP地址和UserAgent。

## 特色分析

### （1）软删除

系统中的记录并没有被真正删除，而是把记录中的某个表示状态的字段设置为删除。

### （2）序列化存储

系统中有许多某种数据对应多个值的情况，比如用户的联系信息、商品的图片、订单的评论等，当然可以把这些信息分别存储到多个字段中，但是将存放多个值的数据序列化并放到数据库中也许更加方便。

### （3）混合应用

混合应用（Hybred App）是介于本地应用和Web应用之间的一种应用形式，兼具两者的优点，并且能够极大的提高开发效率。采用这种开发模式，能够保证我们在尽可能短的时间里推出覆盖多平台的移动应用软件。这里使用[CrossWalk](https://crosswalk-project.org/)生成跨平台的混合应用。

## 作品展示

网页版应用**<http://www.mysdnu.com/>**,采用自适应网页设计，分别适配4中屏幕分辨率（PC、手机、Pad横屏、Pad竖屏）。

Android客户端可从下面的网站点击下载安装使用
**<http://7xiyyf.com1.z0.glb.clouddn.com/mysdnu-app-v1.0.apk>**。

现在的用户登录使用的是[OAuth授权登录](http://i.sdnu.edu.cn/open/)，提供几个测试账号。前两个账号拥有管理员权限，登录后从右上角下拉菜单进入。

```
学工号：201101110407
密码：304213
学工号：201101110444
密码：084829
学工号：992012057035
密码：304213
```

-EOF-
